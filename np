#!/bin/bash
#  np: New Project C/C++ build system

rootdir=$(pwd) # Current directory, for reference (this will serve as our "home")

xit() {
  printf "\033[0m"
  exit 0
}

create_new_project() {
  xit
}

regenerate_buildscript() {
  printf "\nthis is not what it sounds like\n"
  xit
}

extract_project_json() {
  output=$(sed -n "/&#123 __BEGIN_PROJECT_JSON__/,/} __END_PROJECT_JSON__/p" np) # Read the file and extract the project.json file
  echo "$output" >> .np/project.json # Write it to disk
}

if [ -f "$rootdir/.np/project.json" ]; then
  printf "Regenerating build script...\n"
  regenerate_buildscript
  xit
fi

printf "No project exists in your current working directory. Would you like to create a new one? \033[1m[Y/n]\033[0m "
read -p "" -n 1 -r
if [[ $REPLY =~ ^[Nn]$ ]]; then
  printf "\nThen why did you launch this script???\n"
  xit
fi
if [[ $REPLY =~ ^[Yy]$ ]]; then
  printf "\n\n"
  mkdir -p .np
  extract_project_json
  xit
fi

printf "\033[0m"
exit 0

# This is the default project.json file that will be written to disk (never touched by shell)
{ __BEGIN_PROJECT_JSON__
  "projectname": "*np_name",
  "stdversion": "*np_stdver",
  "configurations": [
    {
      "configname": "*np_confname",
      "os": "*np_os",
      "arch": "*np_arch",
      "gcc": "*np_gcc",
      "g++": "*np_gpp",
      "compilerargs": [
        "*np_args"
      ],
      "sourcefiles": [
        "*np_srcfiles"
      ],
      "cincludedirs": [
        "*np_cincs"
      ],
      "cppincludedirs": [
        "*np_cppincs"
      ],
      "libdirs": [
        "*np_libdirs"
      ],
      "ldlibs": [
        "*np_ldlibs"
      ]
    }
  ],
  "vscodeintegration": *np_vsctrf,
  "vscodefolder": "*np_vscf"
} __END_PROJECT_JSON__