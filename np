#!/bin/bash
#  np: New Project C/C++ build system

rootdir=$(pwd) # Current directory, for reference (this will serve as our "home")

# Embedded files (decoded from base64 just before writing)
project_json=$(cat <<EOF
ewogICJwcm9qZWN0bmFtZSI6ICJucF9uYW1lIiwKICAiY3N0ZHZlcnNpb24iOiAibnBfY3N0ZHZlciIsCiAgImNwcHN0ZHZlcnNpb24iOiAibnBfY3Bwc3RkdmVyIiwKICAiY29uZmlndXJhdGlvbnMiOiBbCiAgICB7CiAgICAgICJjb25maWduYW1lIjogIm5wX2NvbmZuYW1lIiwKICAgICAgIm9zIjogIm5wX29zIiwKICAgICAgImFyY2giOiAibnBfYXJjaCIsCiAgICAgICJnY2MiOiAibnBfZ2NjIiwKICAgICAgImcrKyI6ICJucF9ncHAiLAogICAgICAiY29tcGlsZXJhcmdzIjogWwogICAgICAgICJucF9hcmdzIgogICAgICBdLAogICAgICAic291cmNlZmlsZXMiOiBbCiAgICAgICAgIm5wX3NyY2ZpbGVzIgogICAgICBdLAogICAgICAiY2luY2x1ZGVkaXJzIjogWwogICAgICAgICJucF9jaW5jcyIKICAgICAgXSwKICAgICAgImNwcGluY2x1ZGVkaXJzIjogWwogICAgICAgICJucF9jcHBpbmNzIgogICAgICBdLAogICAgICAibGliZGlycyI6IFsKICAgICAgICAibnBfbGliZGlycyIKICAgICAgXSwKICAgICAgImxkbGlicyI6IFsKICAgICAgICAibnBfbGRsaWJzIgogICAgICBdCiAgICB9CiAgXSwKICAidnNjb2RlaW50ZWdyYXRpb24iOiBucF90cmYsCiAgInZzY29kZWZvbGRlciI6ICJucF92c2NmIgp9
EOF
)
template_cpp=$(cat <<EOF
Ly9tYWluLmNwcDogPGRlc2NyaWJlIHdoYXQgdGhpcyBmaWxlIGRvZXM+CgovL0luY2x1ZGVzCiNpbmNsdWRlIDxpb3N0cmVhbT4gLy9Db25zb2xlIEkvTyBzdHJlYW1zCgppbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKSB7CiAgLy9tYWtlIHN0YWxsbWFuIHByb3VkIQoKICByZXR1cm4gMDsKfQ==
EOF
)

xit() {
  printf "\033[0m"
  exit 0
}

regenerate_buildscript() {
  printf "\nthis is not what it sounds like\n"
  xit
}

if [ -f "$rootdir/.np/project.json" ]; then
  printf "Regenerating build script...\n"
  regenerate_buildscript
  xit
fi

printf "No project exists in your current working directory. Would you like to create a new one? \033[1m[Y/n]\033[0m "
read -n 1 -r
if [[ $REPLY =~ ^[Nn]$ ]]; then
  printf "\nThen why did you launch this script???\n"
  xit
fi
if [[ $REPLY =~ ^[Yy]$ ]]; then
  mkdir -p .np
  echo $project_json | base64 -d >> .np/project.json # Extract project.json
  printf "\n\n\033[38;2;57;255;60m.np/project.json\033[0m written successfully.\n"
  mkdir -p src
  echo $template_cpp | base64 -d >> src/main.cpp # Extract main.cpp
  printf "\033[38;2;57;237;255msrc/main.cpp\033[0m written successfully.\n"
  xit
fi

printf "\033[0m"
exit 0